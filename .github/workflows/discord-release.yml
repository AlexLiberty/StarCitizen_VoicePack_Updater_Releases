name: Discord Release Notification

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          sanitized_description=$(echo "${{ github.event.release.body }}" | jq -Rsa .)
          payload=$(cat <<EOF
{
  "username": "Release Bot",
  "avatar_url": "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png",
  "embeds": [{
    "title": "ðŸš€ New Release: ${{ github.event.release.name }}",
    "description": $sanitized_description,
    "url": "${{ github.event.release.html_url }}",
    "color": 5814783
  }]
}
EOF
)
          curl -H "Content-Type: application/json" -X POST -d "$payload" "$DISCORD_WEBHOOK"
